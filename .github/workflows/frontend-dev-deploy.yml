name: Deploy Frontend to Dev

on:
  workflow_dispatch:
    inputs:
      image_tag:
        description: 'Commit SHA to deploy to dev (will use dev-<sha>)'
        required: true
        default: ''

jobs:
  deploy-dev:
    runs-on: [self-hosted, spothub-1]

    env:
      
      IMAGE_TAG: ${{ github.event.inputs.image_tag }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Deploy frontend to DEV namespace
        run: |
          TAG="${IMAGE_TAG}"
          if ! echo "$TAG" | grep -Eq '^[0-9a-f]{40}$'; then
          echo "ERROR: image_tag must be full 40-char commit SHA, got: '$TAG'"
          exit 1
          fi
          IMAGE="zilov14/full-mvp-frontend:dev-${TAG}"
          echo "Deploying ${IMAGE} to sporthub-dev..."
          kubectl -n sporthub-dev set image deployment/sporthub-frontend frontend="${IMAGE}"
          kubectl -n sporthub-dev rollout status deployment/sporthub-frontend
